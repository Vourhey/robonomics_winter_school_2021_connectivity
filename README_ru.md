# Robonomics Winter School 2021: Connectivity

## IoT как слоенный пирог

* Прошивка
    * FreeRTOS
    * ESP/Arduino
    * Одноплатные компьютеры (RPi, LattePanda etc)
* Подключение (Connectivity)
    * IoT Hub
    * IoT Manager
* Сервисы аналитики
    * AWS
    * Google Cloud IoT Core
    * ThingsBoard

Как правило, большинство интересуют не датчики и серверы, а аналитика данных.
Но чтобы её получить необходимо решить, какое устройство использовать, как с ним работать и куда подключать

## Прошивка

Рассмотрим на примере домашней метеостанции. Необходимо собирать данные о загрязнении воздуха (SDS011), температуре и влажности (BME). С такой задачей вполне справится ESP8266 микроконтроллер. 

Требования:

* Правильно читать данные с датчиков
* Иметь уникальный идентификатор
* Передавать данные на известный сервер
* Предоставлять цифровую подпись данных (опционально)

Найти актуальную прошивку можно [здесь](https://github.com/LoSk-p/sensors-software/tree/366b19bf447a5fc19220ef89eab0f2440f8db1c2)

## Что такое Connectivity? 

Под connectivity в мире IoT понимается подключение различных IoT устройств к сети интернет для отправки данных и/или управления устройством.

Известные архитектурные решения можно условно разделить на 3 группы:

* Полностью децентрализованный. Например, устройства связаны mesh сетью. Не подходит для глобальных сетей из-за высоких требований к аппаратной составляющей
* Централизованный. Например, AWS. Обеспечивает единую точку входа и простоту в подключении, но существует большой риск выхода из строя в случае проблем с сервером
* Гибридный. Например, [Robonomics Connectivity](https://github.com/airalab/sensors-connectivity). Предоставляет адрес для устройств в “локальной” сети и публикует данные в распределенный канал сообщений IPFS

## Сравнение AWS и Robonomics Connectivity

| Сервисы               | AWS                               	|               Robonomics              	|
|---------------------	|-----------------------------------	|:-------------------------------------:	|
| Типа транзакции    	| Техническая                          	| Техникоэкономическая                  	|
| Безопасность         	| Под управлением облачной IT-компании	| Polkadot и Ethereum                    	|
| Протоколы            	| HTTPS, MQTT                       	| IPFS, Robonomics                      	|
| Экосистема           	| Закрытая                            	| Распределенная                           	|
| Доступ к DeFi      	| Нет                                	| Да                                       	|
| Стоимость            	| Публикация данных - $1-2 за 1 датчик	| Публикация данных - $0                  	|
|                     	| "Тень"         - от $10 в месяц    	| Цифровой двойник  - $0,01 за транзакцию 	|

## Практика

### Траектория 1. Прошить датичк ESP + SDS011

Требования:

* ESP8266
* Хотя бы один из датчиков SDS011, BME280, HTU21D

Воспользуйтесь [инструкцией](https://wiki.robonomics.network/docs/connect-sensor-to-robonomics/), чтобы подключить датчик к Robonomics Connectivity. 

Проверьте, что ваш датчик появился на нашей [карте](https://sensors.robonomics.network/#/).

### Траектория 2. Запустить Connectivity

Требования:

* Знание ROS
* Python
* Nix (желательно)

Соберите и запустите пакет [sensors-connectivity](https://github.com/airalab/sensors-connectivity#get-a-package-and-build)

> Инструкция по установке [здесь](https://wiki.robonomics.network/docs/iot-sensors-connectivity/) и настройке [здесь](https://wiki.robonomics.network/docs/configuration-options-description/)

Общая схема работы пакета:

```
    station1 \                        / feeder1
    station2 -  sensors-connectivity  - feeder2
    station3 /                        \ feeder3
```

На выбор предлагается реализовать либо новую станцию, например, генератор случайных чисел, либо новый фидер, например, выводящий строку на экран.

Интерфейс `IStation` [здесь](https://github.com/airalab/sensors-connectivity/blob/master/src/stations/istation.py#L73).

Интерфейс `IFeeder` [здесь](https://github.com/airalab/sensors-connectivity/blob/master/src/feeders/ifeeder.py#L5)

